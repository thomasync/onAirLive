{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"./share/share.component\";\nfunction AppComponent_h1_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.directCounter, \"/\", ctx_r0.limitCounter, \"\");\n  }\n}\nfunction AppComponent_h1_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\");\n    i0.ɵɵtext(1, \"Ferm\\u00E9\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_h2_6_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"s\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_h2_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1, \"personne\");\n    i0.ɵɵtemplate(2, AppComponent_h2_6_span_2_Template, 2, 0, \"span\", 3);\n    i0.ɵɵtext(3, \" en ce moment\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.directCounter > 1);\n  }\n}\nfunction AppComponent_div_8_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"s\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h4\");\n    i0.ɵɵtext(4);\n    i0.ɵɵtemplate(5, AppComponent_div_8_span_5_Template, 2, 0, \"span\", 3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const h_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(h_r6.label);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", h_r6.nombre, \" personne\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", h_r6.nombre > 1);\n  }\n}\nfunction AppComponent_app_share_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-share\", 12);\n    i0.ɵɵlistener(\"onClose\", function AppComponent_app_share_15_Template_app_share_onClose_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.shareOpened = false);\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nexport class AppComponent {\n  constructor(_http, _route) {\n    this._http = _http;\n    this._route = _route;\n    this.urlApi = 'https://api.resamania.com/onair/public/attendances/qDf9-6Gnm-8Hoa-18xs';\n    this.directCounter = 0;\n    this.limitCounter = 0;\n    this.lastReload = 9;\n    this.lastReloadTimestamp = 0;\n    this.horaires = [];\n    this.shareOpened = true;\n    this._route.queryParams.subscribe(params => {\n      this.shareOpened = !(params.app !== undefined && params.app === 'true');\n    });\n    this.getInformations(() => {\n      setInterval(() => {\n        this.actualiseLastReload();\n      }, 1000);\n    });\n  }\n  generateLastHoraires(callback) {\n    const date = new Date();\n    let hour = date.getHours();\n    let demi = date.getMinutes() >= 30;\n    this.isDemi = demi;\n    this.horaires = [];\n    for (let i = 0; i < 5; i++) {\n      this.horaires.push({\n        label: (hour < 10 ? '0' : '') + hour + 'H' + (demi ? '30' : '00'),\n        nombre: 0\n      });\n      if (demi) {\n        demi = false;\n      } else {\n        hour -= 1;\n        demi = true;\n      }\n    }\n    if (callback) {\n      callback();\n    }\n  }\n  getInformations(callback) {\n    this.generateLastHoraires(() => {\n      this._http.get(this.urlApi, {\n        responseType: 'text'\n      }).subscribe(html => {\n        this.directCounter = +html.match(/<div class=\"attendance\">.*?<span class=\"value\">(\\d+)<\\/span>/si)[1];\n        try {\n          this.limitCounter = +html.match(/let limit = (\\d+)(;|)\\s/si)[1];\n        } catch (e) {\n          this.limitCounter = 49;\n        }\n        const matchDatasets = html.match(/.*datasets: \\[(.*?)options:/si)[1];\n        const matchDatas = matchDatasets.match(/data: (\\[.*?\\])/gs);\n        const hours = JSON.parse(matchDatas[1].replace('data: ', '')).reverse();\n        const hoursDemi = JSON.parse(matchDatas[0].replace('data: ', '')).reverse();\n        let index = 0;\n        hoursDemi.forEach(e => {\n          hours.splice(index, 0, e);\n          index += 2;\n        });\n        index = !this.isDemi ? 1 : 0;\n        this.horaires.forEach(e => {\n          e.nombre = hours[index];\n          index += 1;\n        });\n      }, () => {\n        alert('Une erreur est survenue');\n      });\n      this.lastReloadTimestamp = Date.now();\n      this.actualiseLastReload();\n      if (callback) {\n        callback();\n      }\n    });\n  }\n  actualiseLastReload() {\n    const date = new Date();\n    this.lastReload = 9 - Math.floor((Date.now() - this.lastReloadTimestamp) / 1000);\n    this.closed = date.getHours() < 7 || date.getHours() >= 22;\n    if (this.lastReload < 0) {\n      this.getInformations();\n    }\n  }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 16,\n  vars: 6,\n  consts: [[\"title\", \"Actualiser les informations\", \"id\", \"reload\", 3, \"click\"], [\"id\", \"app\"], [\"id\", \"box\"], [4, \"ngIf\"], [\"id\", \"infos\"], [\"class\", \"info\", 4, \"ngFor\", \"ngForOf\"], [\"target\", \"_blank\", \"href\", \"https://onair-fitness.fr/club/beziers/\", \"id\", \"statut\"], [\"id\", \"logo\"], [\"id\", \"desc\"], [\"target\", \"_blank\", \"href\", \"https://thomascauquil.fr\", \"id\", \"copyright\"], [3, \"onClose\", 4, \"ngIf\"], [1, \"info\"], [3, \"onClose\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_div_click_0_listener() {\n        return ctx.getInformations();\n      });\n      i0.ɵɵtext(1);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\", 1)(3, \"div\", 2);\n      i0.ɵɵtemplate(4, AppComponent_h1_4_Template, 2, 2, \"h1\", 3);\n      i0.ɵɵtemplate(5, AppComponent_h1_5_Template, 2, 0, \"h1\", 3);\n      i0.ɵɵtemplate(6, AppComponent_h2_6_Template, 4, 1, \"h2\", 3);\n      i0.ɵɵelementStart(7, \"div\", 4);\n      i0.ɵɵtemplate(8, AppComponent_div_8_Template, 6, 3, \"div\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"a\", 6);\n      i0.ɵɵelement(10, \"div\", 7);\n      i0.ɵɵelementStart(11, \"span\", 8);\n      i0.ɵɵtext(12, \"ON AIR B\\u00E9ziers\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(13, \"a\", 9);\n      i0.ɵɵtext(14, \"Thomas Cauquil\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(15, AppComponent_app_share_15_Template, 1, 0, \"app-share\", 10);\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\"\", ctx.lastReload, \"s\");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", !ctx.closed);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.closed);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.closed);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.horaires);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"ngIf\", ctx.shareOpened);\n    }\n  },\n  dependencies: [i3.NgForOf, i3.NgIf, i4.ShareComponent],\n  styles: [\"#reload[_ngcontent-%COMP%]{position:fixed;top:40px;left:5%;color:#fff6;z-index:5;transition:color .2s ease;font-size:clamp(16px,4vw,30px);cursor:pointer}#reload[_ngcontent-%COMP%]:hover{color:#ffffff4d}#reload[_ngcontent-%COMP%]:active{color:#fff3}#app[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;position:fixed;inset:0;padding:20px;background:#d52e28}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]{text-align:center}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;font-size:clamp(20px,20vw,200px);margin:0;padding:0}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:200;font-size:clamp(16px,4vw,100px);margin:0;padding:0}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #infos[_ngcontent-%COMP%]{margin-top:20px;border-top:1px solid white}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #infos[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;padding-top:10px}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #infos[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;width:150px;font-size:clamp(12px,4vw,20px);text-align:left;font-weight:700}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #infos[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;width:100%;text-align:right;font-size:clamp(12px,4vw,20px);font-weight:300}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #statut[_ngcontent-%COMP%]{display:flex;margin:20px auto 15px;width:180px;text-align:center;text-decoration:none;color:#fff}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #statut[_ngcontent-%COMP%]   #logo[_ngcontent-%COMP%]{width:50px;height:50px;background:url(onairlogo.jpg) no-repeat center;background-size:100%;margin-right:10px}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #statut[_ngcontent-%COMP%]   #desc[_ngcontent-%COMP%]{display:block;height:50px;font-weight:700;line-height:50px}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #copyright[_ngcontent-%COMP%]{background-color:#ffffff1a;color:#fff;padding:10px;letter-spacing:3px;border-radius:5px;text-decoration:none;transition:background-color .2s ease}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #copyright[_ngcontent-%COMP%]:hover{background-color:#ffffff0a}#app[_ngcontent-%COMP%]   #box[_ngcontent-%COMP%]   #copyright[_ngcontent-%COMP%]:active{background-color:#fff0}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}